CodeMirror.modeExtensions||(CodeMirror.modeExtensions={}),CodeMirror.defineExtension("getModeExt",function(){var e=CodeMirror.resolveMode(this.getOption("mode")).name,t=CodeMirror.modeExtensions[e];if(!t)throw new Error("No extensions found for mode "+e);return t}),CodeMirror.defineExtension("getModeExtAtPos",function(e){var t=this.getTokenAt(e);return t&&t.state&&t.state.mode?CodeMirror.modeExtensions["html"==t.state.mode?"htmlmixed":t.state.mode]:this.getModeExt()}),CodeMirror.defineExtension("commentRange",function(e,t,n){var r=this.getModeExtAtPos(this.getCursor());if(e){this.getRange(t,n);this.replaceRange(r.commentStart+this.getRange(t,n)+r.commentEnd,t,n),t.line==n.line&&t.ch==n.ch&&this.setCursor(t.line,t.ch+r.commentStart.length)}else{var o=this.getRange(t,n),s=o.indexOf(r.commentStart),i=o.lastIndexOf(r.commentEnd);s>-1&&i>-1&&i>s&&(o=o.substr(0,s)+o.substring(s+r.commentStart.length,i)+o.substr(i+r.commentEnd.length)),this.replaceRange(o,t,n)}}),CodeMirror.defineExtension("autoIndentRange",function(e,t){var n=this;this.operation(function(){for(var r=e.line;r<=t.line;r++)n.indentLine(r,"smart")})}),CodeMirror.defineExtension("autoFormatRange",function(e,t){var n=this.indexFromPos(e),r=this.indexFromPos(t),o=this.getModeExt().autoFormatLineBreaks(this.getValue(),n,r),s=this;this.operation(function(){s.replaceRange(o,e,t);for(var r=s.posFromIndex(n).line,i=s.posFromIndex(n+o.length).line,a=r;a<=i;a++)s.indentLine(a,"smart")})}),CodeMirror.modeExtensions.css={commentStart:"/*",commentEnd:"*/",wordWrapChars:[";","\\{","\\}"],autoFormatLineBreaks:function(e,t,n){return(e=e.substring(t,n)).replace(new RegExp("(;|\\{|\\})([^\r\n])","g"),"$1\n$2")}},CodeMirror.modeExtensions.javascript={commentStart:"/*",commentEnd:"*/",wordWrapChars:[";","\\{","\\}"],getNonBreakableBlocks:function(e){for(var t=[new RegExp("for\\s*?\\(([\\s\\S]*?)\\)"),new RegExp("'([\\s\\S]*?)('|$)"),new RegExp('"([\\s\\S]*?)("|$)'),new RegExp("//.*([\r\n]|$)")],n=new Array,r=0;r<t.length;r++)for(var o=0;o<e.length;){var s=e.substr(o).match(t[r]);if(null==s)break;n.push({start:o+s.index,end:o+s.index+s[0].length}),o+=s.index+Math.max(1,s[0].length)}return n.sort(function(e,t){return e.start-t.start}),n},autoFormatLineBreaks:function(e,t,n){e=e.substring(t,n);var r=0,o=new RegExp("(;|\\{|\\})([^\r\n])","g"),s=this.getNonBreakableBlocks(e);if(null!=s){for(var i="",a=0;a<s.length;a++)s[a].start>r&&(i+=e.substring(r,s[a].start).replace(o,"$1\n$2"),r=s[a].start),s[a].start<=r&&s[a].end>=r&&(i+=e.substring(r,s[a].end),r=s[a].end);return r<e.length-1&&(i+=e.substr(r).replace(o,"$1\n$2")),i}return e.replace(o,"$1\n$2")}},CodeMirror.modeExtensions.xml={commentStart:"\x3c!--",commentEnd:"--\x3e",wordWrapChars:[">"],autoFormatLineBreaks:function(e,t,n){for(var r=(e=e.substring(t,n)).split("\n"),o=new RegExp("(^\\s*?<|^[^<]*?)(.+)(>\\s*?$|[^>]*?$)"),s=new RegExp("<","g"),i=new RegExp("(>)([^\r\n])","g"),a=0;a<r.length;a++){var m=r[a].match(o);null!=m&&m.length>3&&(r[a]=m[1]+m[2].replace(s,"\n$&").replace(i,"$1\n$2")+m[3])}return r.join("\n")}},CodeMirror.modeExtensions.htmlmixed={commentStart:"\x3c!--",commentEnd:"--\x3e",wordWrapChars:[">",";","\\{","\\}"],getModeInfos:function(e,t){var n=new Array;n[0]={pos:0,modeExt:CodeMirror.modeExtensions.xml,modeName:"xml"};var r=new Array;r[0]={regex:new RegExp("<style[^>]*>([\\s\\S]*?)(</style[^>]*>|$)","i"),modeExt:CodeMirror.modeExtensions.css,modeName:"css"},r[1]={regex:new RegExp("<script[^>]*>([\\s\\S]*?)(</script[^>]*>|$)","i"),modeExt:CodeMirror.modeExtensions.javascript,modeName:"javascript"};for(var o=void 0!==t?t:e.length-1,s=0;s<r.length;s++)for(var i=0;i<=o;){var a=e.substr(i).match(r[s].regex);if(null==a)break;if(a.length>1&&a[1].length>0){var m=i+a.index+a[0].indexOf(a[1]);n.push({pos:m,modeExt:r[s].modeExt,modeName:r[s].modeName}),n.push({pos:m+a[1].length,modeExt:n[0].modeExt,modeName:n[0].modeName}),i+=a.index+a[0].length}else i+=a.index+Math.max(a[0].length,1)}return n.sort(function(e,t){return e.pos-t.pos}),n},autoFormatLineBreaks:function(e,t,n){var r=this.getModeInfos(e),o=new RegExp("^\\s*?\n"),s=new RegExp("\n\\s*?$"),i="";if(r.length>1)for(var a=1;a<=r.length;a++){var m=r[a-1].pos,d=a<r.length?r[a].pos:n;if(m>=n)break;if(m<t){if(d<=t)continue;m=t}d>n&&(d=n);var g=e.substring(m,d);"xml"!=r[a-1].modeName&&(!o.test(g)&&m>0&&(g="\n"+g),!s.test(g)&&d<e.length-1&&(g+="\n")),i+=r[a-1].modeExt.autoFormatLineBreaks(g)}else i=r[0].modeExt.autoFormatLineBreaks(e.substring(t,n));return i}};