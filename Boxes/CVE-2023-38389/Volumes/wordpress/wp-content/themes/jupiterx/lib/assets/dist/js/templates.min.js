"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function n(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,s){return t&&n(e.prototype,t),s&&n(e,s),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(x){var n=(_createClass(a,[{key:"init",value:function(){var e=this,t=e.element,s=e.filters,n=t.find(".jupiterx-templates-select-field");s.filter(":not([type=text])").on("change",_.debounce(e.update.bind(e),300)),s.filter("[type=text]").on("keyup",_.debounce(e.update.bind(e),300)),n.each(function(e,t){new i(x(t))})}},{key:"events",value:function(){var e=this,t=x(".jupiterx-header");if(t.length){var s=t.data("jupiterx-settings"),n=s.behavior,a=s.position;"fixed"===n&&"top"===a?(e.fixed(),e.window.resize(e.fixed.bind(e))):"sticky"===n&&(e.sticky(),e.window.scroll(e.sticky.bind(e)))}}},{key:"fixed",value:function(){var e=this,t=e.element,s=e.body,n=e.desktop;if(e.window.width()>=n){var a=x(".jupiterx-header"),i=s.offset(),l=s.hasClass("admin-bar")?i.top+a.outerHeight():a.outerHeight();t.css("top",l)}else t.css("top","")}},{key:"sticky",value:function(){var e=this,t=e.element,s=e.body,n=e.desktop,a=x(".jupiterx-header"),i=a.data("jupiterx-settings").offset,l=e.window.scrollTop();if(e.window.width()<n)t.removeClass("sticked"),t.css("top","");else if(!t.hasClass("sticked")&&i<l&&s.hasClass("jupiterx-header-sticked")){var o=s.offset(),r=s.hasClass("admin-bar")?o.top+a.outerHeight():a.outerHeight();t.addClass("sticked"),t.css("top",r)}else t.hasClass("sticked")&&l<=i&&(t.removeClass("sticked"),t.css("top",""))}},{key:"getFilters",value:function(){var n={};return this.filters.each(function(e,t){var s=(t=x(t)).val();s&&(n[t.attr("name")]=s)}),n}},{key:"update",value:function(){this.updateResults(this.getFilters())}},{key:"clearFilters",value:function(){this.filters.filter(":not([name=product_id]):not([name=posts_per_page]):not([name=s])").each(function(e,t){(t=x(t)).val()&&t.val("").trigger("change",{clearFilters:!0})})}}]),a);function a(e){_classCallCheck(this,a);var t=e.element,s=e.updateResults;this.element=t,this.filters=this.element.find(".filter-field"),this.contentFilter=this.filters.filter("[name=s]"),this.window=x(window),this.body=x("body"),this.updateResults=s,this.desktop=768,this.init(),this.events()}var i=(_createClass(s,[{key:"init",value:function(){var s=this,t=s.element,n=s.window,e=s.checkboxes,a=s.clear,i=s.values,l=t.find(".dropdown-toggle");e.each(function(e,t){t=x(t),s.options[t.val()]=t.data("label")}),e.on("change",function(){var e=x(this);s.update(e.val(),e.is(":checked"))}),a.on("click",function(e){e.preventDefault(),e.stopPropagation(),s.clearSelected()}),i.on("change",function(e,t){t&&t.clearFilters&&s.clearSelected()}),l.on("click",function(e){e.preventDefault(),s.expand()}),x(document).on("click",function(e){n.width()>=s.desktop&&(t.is(e.target)||0!==t.has(e.target).length||s.collapse())}),t.on("click",".dropdown-menu",function(e){e.stopPropagation()})}},{key:"update",value:function(e,t){var s=this;t?this.selected.push(e):this.selected.splice(this.selected.indexOf(e),1),this.values.val(this.selected).trigger("change");var n=this.selected.map(function(e){return s.options[e]});n=n.length?n.join(", "):jupiterxTemplates.i18n.all,this.labels.text(n),this.selected.length?this.clear.addClass("show"):this.clear.removeClass("show")}},{key:"clearSelected",value:function(){this.selected.length&&(this.selected=[],this.values.val(this.selected).trigger("change"),this.labels.text(jupiterxTemplates.i18n.all),this.clear.removeClass("show"),this.checkboxes.each(function(e,t){x(t).attr("checked",!1)}))}},{key:"expand",value:function(){var e=this.element,t=this.window,s=this.menu,n=t.width()<=767?"show-mobile":"show",a=!(e.hasClass(n)||s.hasClass(n));e.toggleClass(n,a),s.toggleClass(n,a)}},{key:"collapse",value:function(){this.element.removeClass("show"),this.menu.removeClass("show")}}]),s);function s(e){_classCallCheck(this,s),this.element=x(e),this.window=x(window),this.checkboxes=this.element.find("input[type=checkbox]"),this.menu=this.element.find(".dropdown-menu"),this.values=this.element.find(".selected-values"),this.labels=this.element.find(".selected-labels"),this.clear=this.element.find(".clear-selected"),this.options={},this.desktop=768;var t=this.values.val();this.selected=t?t.split(","):[],this.init()}var l=(_createClass(o,[{key:"events",value:function(){switch(this.getPagination()){case"load_more":this.document.on("click",".jupiterx-templates-loadmore button",this.more.bind(this));break;default:this.window.on("scroll",_.throttle(this.scroll.bind(this),50))}}},{key:"scroll",value:function(){this.ready&&this.check()&&this.load(!1)}},{key:"more",value:function(){this.ready&&this.load(!1)}},{key:"reload",value:function(e){this.load(!0,e)}},{key:"load",value:function(e,s){var n=this;if(e||!n.maxed){var a=n.getFilters();n.ready=!1,n.element.children(".jupiterx-templates-placeholder, .jupiterx-templates-loader, .jupiterx-templates-empty, .jupiterx-templates-loadmore").remove(),e?(n.element.children(".jupiterx-templates-template").remove(),n.page=1,n.maxed=!1,n.placeholder(a)):n.element.append(x(n.loader())),a.page=n.page,Object.keys(a).forEach(function(e){a[e]||delete a[e]}),n.jqxhr&&n.jqxhr.abort&&n.jqxhr.abort(),n.jqxhr=x.ajax({type:"POST",url:_wpUtilSettings.ajax.url,data:{action:"jupiterx_api",nonce:jupiterxTemplates.nonce,method:"get_templates",filters:a}}),n.jqxhr.done(function(t){n.element.children(".jupiterx-templates-placeholder, .jupiterx-templates-loader").remove(),t.posts&&t.posts.length?(t.posts.length<a.posts_per_page&&(n.maxed=!0),t.posts.forEach(function(e){n.element.append(n.card(e,t))})):(n.maxed=!0,e&&n.element.append(x(n.empty()))),n.done(t,a),n.page++,n.ready=!0,"function"==typeof s&&s(t)})}}},{key:"done",value:function(e,t){this.initTemplateInfoPopover(e),this.maxed||"load_more"!==this.getPagination()||this.element.append(x(this.loadmore()))}},{key:"check",value:function(){var e=this.element.offset();if("object"!==(void 0===e?"undefined":_typeof(e)))return!1;var t=this.window.scrollTop()+this.window.height();return this.element.outerHeight(!1)+e.top-2*this.window.height()<t}},{key:"empty",value:function(){return'\n      <div class="jupiterx-templates-empty">\n        <svg class="sad-tear" aria-hidden="true" focusable="false" width="50" height="50" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">\n          <path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm8-152c-13.2 0-24 10.8-24 24s10.8 24 24 24c23.8 0 46.3 10.5 61.6 28.8 8.1 9.8 23.2 11.9 33.8 3.1 10.2-8.5 11.6-23.6 3.1-33.8C330 320.8 294.1 304 256 304zm-88-64c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160-64c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32zm-165.6 98.8C151 290.1 126 325.4 126 342.9c0 22.7 18.8 41.1 42 41.1s42-18.4 42-41.1c0-17.5-25-52.8-36.4-68.1-2.8-3.7-8.4-3.7-11.2 0z"></path>\n        </svg>\n        <p class="empty-title">'+jupiterxTemplates.i18n.empty+'</p>\n        <p class="empty-info">'+jupiterxTemplates.i18n.emptyInfo+"</p>\n      </div>\n      "}},{key:"placeholder",value:function(e){for(var t=e.posts_per_page||12,s=0;s<t;s++)this.element.append(x('\n      <div class="jupiterx-templates-template jupiterx-templates-placeholder">\n        <div class="jupiterx-card">\n          <span class="jupiterx-card-img-top"></span>\n          <div class="jupiterx-card-body">\n            <span class="jupiterx-card-title"></span>\n            <span class="import-template"></span>\n          </div>\n        </div>\n      </div>\n      '))}},{key:"loader",value:function(){return'\n      <div class="jupiterx-templates-loader">\n        <span class="loader-round"></span>\n      </div>\n      '}},{key:"loadmore",value:function(){return'\n      <div class="jupiterx-templates-loadmore">\n        <button class="button">'+jupiterxTemplates.i18n.loadMore+"</button>\n      </div>\n      "}},{key:"card",value:function(t,e){var s=this,n=e.is_pro,a=s.isCustomImport,i=t.demo_url,l=t.featured_image,o=t.free_template,r=t.list_of_used_plugins,p=jupiterxTemplates,c=p.i18n,u=p.isPremium,d=p.proBadgeUrl,m=(p.upgradeLink,t.title),h=t.slug,f=t.psd,g=t.is_sketch;m=m.replace(" Jupiterx",""),h=h.replace("-jupiterx","");var v=x('\n        <div class="jupiterx-templates-template">\n          <div class="jupiterx-card">\n            '+(n||"true"===o?"":'<img class="jupiterx-pro-badge" src="'+d+'" />')+'\n            <span class="jupiterx-card-img-top" style="background-image: url('+l+');"></span>\n            <div class="jupiterx-card-body">\n              <h4 class="jupiterx-card-title">'+m+"</h4>\n              "+(u&&n||"true"===o?'<button class="btn btn-primary import-template">'+c.import+"</button>":"")+'\n              <a class="btn btn-outline-secondary preview-template" target="_blank" href="'+i+'">'+c.preview+"</a>\n              "+(f&&n?'<button class="btn btn-outline-primary psd-link">.psd</button>':"")+"\n              "+(g&&"true"===g.toString()&&n?'<button class="btn btn-outline-primary sketch-link">.sketch</button>':"")+"\n              "+(r&&0<r.length?'<span class="jupiterx-icon-info-circle jupiterx-template-info" data-toggle="popover" data-placement="top" data-id="'+t.id+'"></span>':"")+"\n            </div>\n          </div>\n        </div>\n      ");return v.on("click",".import-template",function(e){e.preventDefault(),a?s.importCustom(t):s.import(t)}),v.on("click",".psd-link",function(e){e.preventDefault(),x.ajax({type:"POST",url:_wpUtilSettings.ajax.url,data:{action:"jupiterx_api",nonce:jupiterxTemplates.nonce,method:"get_template_psd",template_name:h},success:function(e){var t=e.status,s=e.data;t&&s.psd_link&&(top.location.href=s.psd_link)}})}),v.on("click",".sketch-link",function(e){e.preventDefault(),x.ajax({type:"POST",url:_wpUtilSettings.ajax.url,data:{action:"jupiterx_api",nonce:jupiterxTemplates.nonce,method:"get_template_sketch",template_name:h},success:function(e){var t=e.status,s=e.data;t&&s.sketch_link&&(top.location.href=s.sketch_link)}})}),v}},{key:"import",value:function(e){var t=jupiterxTemplates.i18n;jupiterx_modal({type:"warning",title:t.installTitle,text:t.installText.replace("{template}",e.title),confirmButtonText:t.confirm,cancelButtonText:t.cancel,showCancelButton:!0,showConfirmButton:!0,onConfirm:function(){jupiterx_modal({type:"warning",title:t.mediaTitle,text:t.mediaText,confirmButtonText:t.mediaConfirm,cancelButtonText:t.mediaCancel,showCancelButton:!0,showConfirmButton:!0,onConfirm:function(){new r({media:!1,data:e,partial:!1})},onCancel:function(){new r({media:!0,data:e,partial:!1})}})}})}},{key:"importCustom",value:function(n){var a=jupiterxTemplates.i18n,e=x("\n        <h6>"+a.customTitle+'</h6>\n        <ul class="import-types">\n          <li>\n            <div class="custom-control custom-radio">\n              <input type="radio" class="custom-control-input" name="templates-import-type" id="templates-complete-import" checked>\n              <label class="custom-control-label" for="templates-complete-import">\n                <strong>'+a.completeImportTitle+"</strong>\n              </label>\n            </div>\n            <p>"+a.completeImportText+'</p>\n          </li>\n          <li>\n            <div class="custom-control custom-radio">\n              <input type="radio" class="custom-control-input" name="templates-import-type" id="templates-partial-import" '+(jupiterxTemplates.template?"checked":"")+'>\n              <label class="custom-control-label" for="templates-partial-import">\n                <strong>'+a.partialImportTitle+"</strong>\n              </label>\n            </div>\n            <p>"+a.partialImportText+'</p>\n          </li>\n        </ul>\n        <hr>\n        <div class="custom-control custom-checkbox">\n          <input type="checkbox" class="custom-control-input" name="templates-include-media" id="templates-include-media" checked>\n          <label class="custom-control-label" for="templates-include-media">'+a.customMediaText+"</label>\n        </div>\n      ");jupiterx_modal({modalCustomClass:"jupiterx-templates-custom-install-modal",title:a.installTitle,text:e,type:"warning",confirmButtonText:a.install,cancelButtonText:a.discard,showCancelButton:!0,showConfirmButton:!0,showCloseButton:!0,showLearnmoreButton:!1,onConfirm:function(){var e=x("input#templates-include-media").prop("checked"),t=x("input#templates-partial-import").prop("checked"),s=(t?"":""+a.completeImportWarning)+" "+a.askContinue;jupiterx_modal({title:a.installTitle,text:s,type:"warning",confirmButtonText:a.yes,cancelButtonText:a.cancel,showCancelButton:!0,showConfirmButton:!0,showCloseButton:!0,showLearnmoreButton:!1,onConfirm:function(){new r({media:e,data:n,partial:t})}})}})}},{key:"initTemplateInfoPopover",value:function(s){s&&x(".jupiterx-template-info").popover({trigger:"focus hover",container:".jupiterx-cp-install-template",html:!0,content:function(){var e=_.findWhere(s.posts,{id:parseInt(x(this).data("id"))}),t=e&&e.list_of_used_plugins?e.list_of_used_plugins:[];return'\n            <div class="jupiterx-template-info-details">\n              <strong>'+jupiterxTemplates.i18n.plugins_used+":</strong>\n              <span>"+t.join(", ")+"</span>\n            </div>\n          "}})}}]),o);function o(e){_classCallCheck(this,o);var t=e.node,s=e.getFilters,n=e.getPagination,a=e.customImport;this.element=x(t),this.window=x(window),this.document=x(document),this.getFilters=s,this.getPagination=n,this.isCustomImport=a,this.jqxhr=null,this.page=1,this.ready=!0,this.maxed=!1,this.cache={},this.events()}var r=(_createClass(p,[{key:"getActions",value:function(e){return e?["preparation","upload","unzip","validate","install_plugins","theme_content","activate_plugins","plugins_content","finalize"]:["preparation","backup_db","backup_media_records","reset_db","upload","unzip","validate","install_plugins","custom_tables","theme_content","activate_plugins","setup_pages","plugins_content","settings","menu_locations","theme_widget","restore_media_records","finalize"]}},{key:"run",value:function(){var n=this,a=n.actions,e=n.media,t=n.partial,s=n.data;"theme_content"!==a[n.current]?x.ajax({type:"POST",url:_wpUtilSettings.ajax.url,timeout:0,data:{action:"jupiterx_api",method:"import_template",type:a[n.current],import_media:e,template_id:s.id,template_name:s.title,partial_import:t},beforeSend:function(){n.modal||n.modalProgress||(n.modal=n.progress())},success:function(e){var t=e.status,s=e.message;t?"install_plugins"===a[n.current]&&e.install?x.ajax({type:"POST",url:e.url,data:e.install,success:function(){n.message(s),n.current++,n.updateProgressBar(),n.run()}}):(n.message(s),n.current++,n.updateProgressBar(),n.current<a.length?n.run():(n.modal=null,n.done())):n.error(s)},error:function(){n.error()}}):n.importContent()}},{key:"importContent",value:function(){var n=this,e=jupiterxTemplates.adminAjaxUrl,t=jupiterxTemplates.nonce,s=n.media,a=n.partial,i=n.data,l=new URL(e);l.searchParams.append("action","jupiterx_api"),l.searchParams.append("nonce",t),l.searchParams.append("method","import_template_content"),l.searchParams.append("import_media",s),l.searchParams.append("template_id",i.id),l.searchParams.append("template_name",i.title),l.searchParams.append("partial_import",a);var o=new EventSource(l.href);o.addEventListener("message",function(e){var t=JSON.parse(e.data),s="";t.message&&(s=t.message),!t.error&&t.status?(n.message(),n.current++,n.updateProgressBar(),n.run()):n.error(s),o.close()})}},{key:"progress",value:function(){var e=this.partial,t=jupiterxTemplates.i18n,s=x('\n        <div class="jupiterx-modal-header">\n          <h3 class="jupiterx-modal-title">'+t.progressTitle+'</h3>\n        </div>\n        <div class="jupiterx-modal-desc">\n          <ul class="jupiterx-modal-step-list">\n            '+(e?"":'<li class="step-backup">'+t.progressBackup+' <span class="result-message"></span></li>')+'\n            <li class="step-package">'+t.progressPackage+' <span class="result-message"></span></li>\n            <li class="step-plugins">'+t.progressPlugins+' <span class="result-message"></span></li>\n            <li class="step-install">'+t.progressInstall+' <span class="result-message"></span></li>\n          </ul>\n        </div>\n      ');return jupiterx_modal({html:s,showProgress:!0,progress:"0%",showCloseButton:!1,showConfirmButton:!1,closeOnOutsideClick:!1}),s}},{key:"message",value:function(e){if(!(!this.modal instanceof jQuery)){var t=this.modal,s=this.actions,n=this.current,a=t.find(".step-backup .result-message"),i=t.find(".step-package .result-message"),l=t.find(".step-plugins .result-message"),o=t.find(".step-install .result-message");switch(s[n]){case"backup_db":case"backup_media_records":a.text(e);break;case"reset_db":a.text(e).parent().addClass("step-done");break;case"upload":case"unzip":i.text(e);break;case"validate":i.text(e).parent().addClass("step-done");break;case"install_plugins":l.text(e).parent().addClass("step-done");break;case"activate_plugins":o.text(e);break;case"custom_tables":case"theme_content":case"menu_locations":case"setup_pages":case"plugins_content":case"theme_widget":case"restore_media_records":o.text(e);break;case"finalize":o.text(e).parent().addClass("step-done")}}}},{key:"done",value:function(){var e=this,t=jupiterxTemplates.i18n;jupiterx_modal({title:t.completedTitle,text:t.completedText,type:"success",showCancelButton:!1,showConfirmButton:!0,showCloseButton:!1,showLearnmoreButton:!1,closeOnOutsideClick:!1,onConfirm:function(){jupiterxTemplates.template=e.data.id,x(window).trigger("template-installed",{title:e.data.title,id:e.data.id,partial:e.partial,media:e.media})}})}},{key:"error",value:function(e){var t=jupiterxTemplates.i18n;jupiterx_modal({title:t.errorTitle,text:e||t.errorText,type:"error",showCancelButton:!1,showConfirmButton:!0,showCloseButton:!1,showLearnmoreButton:!1,closeOnOutsideClick:!1})}},{key:"updateProgressBar",value:function(){var e=this.current/this.actions.length*100;e=e.toFixed(2),jupiterx_modal.update({progress:e+"%"})}}]),p);function p(e){_classCallCheck(this,p);var t=e.media,s=e.data,n=e.partial;this.modal=null,this.media=t,this.data=s,this.partial=n,this.current=0,this.actions=this.getActions(n),this.run()}var c=(_createClass(u,[{key:"init",value:function(){var e=this,t=this.element,s=this.components;t.data("loaded",!0),s.filters=new n({element:t.find(".jupiterx-templates-filters-container"),updateResults:e.updateResults.bind(this)}),s.results=new l({node:t.find(".jupiterx-templates-results"),getFilters:e.getFilters.bind(this),getPagination:e.getPagination.bind(this),customImport:e.customImport}),e.updateResults(s.filters.getFilters())}},{key:"events",value:function(){var t=this,e=t.element,l=t.components,s=e.find(".jupiterx-templates-toggle-filters .jupiterx-templates-search-field"),n=this.element.find(".jupiterx-templates-toggle-filters .toggle-button"),a=this.element.find(".jupiterx-templates-header .close-button"),i=this.element.find(".jupiterx-templates-header .clear-filters");s.each(function(e,t){function s(){var e=l.filters.contentFilter;e.val(a.val()),e.trigger("keyup")}var n=x(t),a=n.find("input"),i=n.find(".clear-button");a.on("keyup",function(e){a.val()?i.show():i.hide(),13===e.keyCode&&(e.preventDefault(),s())}),n.on("click",".search-button",function(){s()}),i.on("click",function(){i.hide(),a.val(""),s()})}),n.on("click",function(e){e.preventDefault(),t.showHide(!0)}),a.on("click",function(e){e.preventDefault(),t.showHide(!1)}),i.on("click",function(){l.filters.clearFilters()})}},{key:"updateResults",value:function(e){var t=this,s=t.element,n=t.foundPosts,a=t.count,i=t.components;t.filters=_extends({},e);var l=["s","posts_per_page","product_id"];for(var o in e)0<=l.indexOf(o)&&delete e[o];s.addClass("is-loading"),a.text(Object.keys(e).length||0),t.scroll(),i.results.reload(function(e){s.removeClass("is-loading"),n.text(e.found_posts||0)})}},{key:"getFilters",value:function(){return _extends({},this.filters)}},{key:"scroll",value:function(){var e=this.element,t=this.window,s=this.html,n=this.body,a=e.offset().top;if(n.hasClass("admin-bar")){var i=s.css("margin-top");a-=parseFloat(i)}t.scrollTop()>a&&t.scrollTop(a)}},{key:"showHide",value:function(e){var t=this.components,s=this.body;t.filters.element.toggleClass("show",e),s.toggleClass("jupiterx-templates-block-scroll",e)}},{key:"getPagination",value:function(){return this.pagination}}]),u);function u(e){var t=e.node,s=e.customImport;_classCallCheck(this,u),this.element=x(t),this.window=x(window),this.html=x("html"),this.body=x("body"),this.count=this.element.find(".jupiterx-templates-toggle-filters .filters-count"),this.foundPosts=this.element.find(".jupiterx-templates-toggle-filters .found-posts"),this.pagination=this.element.data("pagination"),this.customImport=s,this.filters={},this.components={},this.init(),this.events()}window.jupiterx=jQuery.extend({},window.jupiterx,{templates:{installedTemplate:jupiterxTemplates.installedTemplate||null,init:function(e){var s=(0<arguments.length&&void 0!==e?e:{}).customImport;x(".jupiterx-templates-search").each(function(e,t){x(t).data("loaded")||new c({node:t,customImport:s})})}}})}(jQuery);