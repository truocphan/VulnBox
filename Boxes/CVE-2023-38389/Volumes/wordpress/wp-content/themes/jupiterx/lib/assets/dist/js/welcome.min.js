"use strict";var _createClass=function(){function l(e,i){for(var t=0;t<i.length;t++){var l=i[t];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(e,i,t){return i&&l(e.prototype,i),t&&l(e,t),e}}();function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}!function(n,e){function i(){_classCallCheck(this,i),this.setState(),this.setElements(),this.fetchInactiveRequiredPlugins(),this.events()}new(_createClass(i,[{key:"setState",value:function(){this.state={bulkActions:[],plugins:[]}}},{key:"setElements",value:function(){this.el={$pluginInactivatedList:n(".jupiterx-welcome-rplugins-failed"),$pluginList:n(".jupiterx-welcome-rplugins-list"),$progress:n(".jupiterx-welcome-rplugins-progress"),$error:n(".jupiterx-welcome-rplugins-error"),$pluginAction:n(".jupiterx-welcome-rplugins-action"),$actionBtn:n(".jupiterx-welcome-rplugins-action-btn")}}},{key:"events",value:function(){var e=this;n(document).on("click",".jupiterx-welcome-rplugins-action-btn",function(){return e.installPlugins()})}},{key:"installPlugins",value:function(){var e=this,i=this.state.bulkActions;i=this.getCheckedPlugins(i,"install"),this.el.$actionBtn.addClass("installing").attr("disabled","disabled").find("span:last-child").text(jupiterxWelcome.i18n.installText+"..."),n.ajax({url:i.install_required_plugins.url,method:"POST",data:i.install_required_plugins,success:function(){e.el.$actionBtn.removeClass("installing").removeAttr("disabled").find("span:last-child").text(jupiterxWelcome.i18n.defaultText),e.activatePlugins()},error:function(){e.el.$actionBtn.removeClass("installing").removeAttr("disabled").find("span:last-child").text(jupiterxWelcome.i18n.defaultText),e.el.$pluginInactivatedList.find(".welcome-plugin-error div").append(jupiterxWelcome.i18n.failedInstallText).append(jupiterxWelcome.i18n.failedActionLinks),e.el.$pluginInactivatedList.find(".welcome-plugin-error").show(),e.el.$pluginInactivatedList.show()}})}},{key:"activatePlugins",value:function(){var e=this,i=this.state.bulkActions;i=this.getCheckedPlugins(i,"active"),this.el.$actionBtn.addClass("activating").attr("disabled","disabled").find("span:last-child").text(jupiterxWelcome.i18n.activateText+"..."),n.ajax({url:i.activate_required_plugins.url,method:"POST",data:i.activate_required_plugins,success:function(){e.el.$actionBtn.removeClass("activating").removeAttr("disabled").find("span:last-child").text(jupiterxWelcome.i18n.redirecting+"..."),window.location.href=jupiterxWelcome.controlPanelUrl},error:function(){e.el.$actionBtn.removeClass("activating").removeAttr("disabled").find("span:last-child").text(jupiterxWelcome.i18n.defaultText),e.el.$pluginInactivatedList.find(".welcome-plugin-error div").append(jupiterxWelcome.i18n.failedActivateText).append(jupiterxWelcome.i18n.failedActionLinks),e.el.$pluginInactivatedList.find(".welcome-plugin-error").show(),e.el.$pluginInactivatedList.show()}})}},{key:"fetchInactiveRequiredPlugins",value:function(){var i=this;0!==this.el.$pluginList.length&&(this.toggleProgress(!0),e.ajax.post("jupiterx_get_plugins",{_ajax_nonce:this.el.$pluginList.data("nonce")}).done(function(e){return e&&e.bulk_actions&&0!==e.bulk_actions.length&&e&&e.plugins&&0!==e.plugins.length?(i.state.bulkActions=e.bulk_actions,i.insertPlugins(e.plugins),i.toggleProgress(!1),i.toggleError(!1),void i.togglePlugins(!0)):(i.toggleProgress(!1),i.togglePlugins(!1),void i.toggleError(!0))}).fail(function(){i.toggleProgress(!1),i.togglePlugins(!1),i.toggleError(!0)}))}},{key:"insertPlugins",value:function(e){this.el.$pluginList.html("");var i=!0,t=!1,l=void 0;try{for(var n,s=e[Symbol.iterator]();!(i=(n=s.next()).done);i=!0){var a=n.value;if(!jupiterxWelcome.isPremium&&["sellkit","sellkit-pro"].includes(a.slug))return;this.el.$pluginList.append(this.preparePluginTemplate(a))}}catch(e){t=!0,l=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw l}}}},{key:"toggleError",value:function(e){e?this.el.$error.css("display","flex"):this.el.$error.css("display","none")}},{key:"toggleProgress",value:function(e){e?this.el.$progress.css("display","flex"):this.el.$progress.css("display","none")}},{key:"togglePlugins",value:function(e){if(e)return this.el.$pluginList.css("display","flex"),void this.el.$pluginAction.css("display","flex");this.el.$pluginList.css("display","none"),this.el.$pluginAction.css("display","none")}},{key:"preparePluginTemplate",value:function(e){return'\n        <div class="jupiterx-welcome-rplugins-list-item jupiterx-welcome-plugin-'+e.slug+'">\n          <div class="jupiterx-welcome-rplugins-list-item-header">\n            <img\n              src="'+e.img_url+'"\n              alt="'+e.name+'" />\n            <label class="jupiterx-welcome-rplugins-toggle">\n              <input type="checkbox" data-basename="'+e.basename+'" data-slug="'+e.slug+'" checked>\n              <span></span>\n            </label>\n          </div>\n          <div class="jupiterx-welcome-rplugins-list-item-body">\n            <div class="jupiterx-welcome-rplugins-list-item-title">\n              '+e.name+'\n            </div>\n            <div class="jupiterx-welcome-rplugins-list-item-desc">\n              '+e.desc+"\n            </div>\n          </div>\n        </div>\n      "}},{key:"getCheckedPlugins",value:function(e,t){var i=n(".jupiterx-welcome-rplugins-toggle input[type=checkbox]:checked"),l=[];return n.each(i,function(e,i){"install"===t&&l.push(n(i).data("slug")),"active"===t&&l.push(n(i).data("basename"))}),"install"===t&&(l.includes("sellkit-pro")||(l=l.filter(function(e){return"sellkit"!==e})),e.install_required_plugins.plugin=l),"active"===t&&(l.includes("sellkit-pro/sellkit-pro.php")||(l=l.filter(function(e){return"sellkit/sellkit.php"!==e})),e.activate_required_plugins.checked=l),e}}]),i)}(jQuery,wp);