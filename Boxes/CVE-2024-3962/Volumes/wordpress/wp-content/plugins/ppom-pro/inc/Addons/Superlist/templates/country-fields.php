<?php


$countries_obj = new WC_Countries();
$wc_countries  = $countries_obj->__get( 'countries' );


$already_select = isset( $meta['selected'] ) ? $meta['selected'] : '';
$preview_text   = $already_select;

if ( isset( $_POST['ppom']['fields'][ $data_name ] ) && ! empty( $_POST['ppom']['fields'][ $data_name ] ) ) {

	$preview_text = isset( $_POST['ppom']['fields'][ $data_name ] ) ? $_POST['ppom']['fields'][ $data_name ] : $already_select;
} elseif ( isset( $_GET[ $data_name ] ) && ! empty( $_GET[ $data_name ] ) ) {

	$preview_text = isset( $_GET[ $data_name ] ) ? $_GET[ $data_name ] : $already_select;
}


$meta['id']          = $data_name;
$input_wrapper_class = 'form-group';
$input_wrapper_class = apply_filters( 'ppom_input_wrapper_class', $input_wrapper_class, $meta );

$option_exclude = isset( $meta['option_exclude'] ) ? $meta['option_exclude'] : '';
$option_exclude = explode( "\n", $option_exclude );


if ( ! empty( $option_exclude ) ) {
	foreach ( $option_exclude as $ex_country_code ) {

		$ex_country_code = stripslashes( trim( strtoupper( $ex_country_code ) ) );

		unset( $wc_countries[ $ex_country_code ] );

	}
}


$html = '<div class="' . esc_attr( $input_wrapper_class ) . '">';

if ( $field_label ) {
	$html .= '<label class="form-control-label" for="' . esc_attr( $data_name ) . '">';
	$html .= sprintf( __( '%s', 'woocommerce-product-addon' ), $field_label ) . '</label>';
}

$html .= '<select class="' . $classes[0] . '"  name="ppom[fields][' . $data_name . ']">';
foreach ( $wc_countries as $country_code => $country_name ) {

	$html .= '<option ' . selected( $preview_text, $country_name, false ) . ' value="' . $country_name . '">' . $country_name . '</option>';
}
$html .= '</select>';


$html .= '</div>';    // form-group

echo apply_filters( 'ppom_country_html', $html );
